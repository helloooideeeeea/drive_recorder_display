カメラリスト
v4l2-ctl --list-devices

対応している色表現フォーマット
v4l2-ctl -d /dev/video2 --list-formats

対応している解像度等
v4l2-ctl -d /dev/video2 --list-formats-ext

解像度変更等
v4l2-ctl -v -d /dev/video2 width=640,height=480,pixelformat=YUYV

フレームレート
v4l2-ctl -d /dev/video2 -p 20

詳細
v4l2-ctl -d /dev/video2 --all

カメラデバイスのRGBを仮想カメラデバイスに送る（物理デバイスは、マルチプロセスをブロックするため）
gst-launch-1.0 v4l2src device=/dev/video2 ! videoconvert ! video/x-raw,format=I420,width=640,height=480,framerate=30/1 ! v4l2sink device=/dev/video4

マルチで送る場合（こっちを採用）
gst-launch-1.0 v4l2src device=/dev/video0 ! videoconvert ! video/x-raw,format=I420,width=640,height=480,framerate=30/1 ! tee name=tp tp. ! queue ! v4l2sink device=/dev/video4 tp. ! queue ! v4l2sink device=/dev/video5

仮想カメラデバイスを登録
sudo modprobe v4l2loopback

仮想カメラデバイスを削除
sudo modprobe -r v4l2loopback

複数の仮想カメラデバイスをつくる。
sudo modprobe v4l2loopback devices=4

完成形（動画音声ミックス、ソフトウェアエンコード）
gst-launch-1.0 -e v4l2src device="/dev/video4" ! queue ! videoconvert ! x264enc tune=zerolatency ! mux. alsasrc device="hw:2" ! queue ! audioconvert ! audioresample ! voaacenc ! aacparse ! qtmux name=mux ! filesink location=test5.mp4 sync=false

完成系（動画音声ミックス。ハードウェアエンコード。たまに失敗する。謎）
gst-launch-1.0 -e v4l2src device="/dev/video4" ! queue ! videoconvert ! v4l2h264enc ! 'video/x-h264,level=(string)4' ! h264parse ! mux. alsasrc device="hw:2" ! queue ! audioconvert ! audioresample ! voaacenc ! aacparse ! qtmux name=mux ! filesink location=test5.mp4 sync=false

動画のみ（リアルタイム音声ミックスは、不安定）
gst-launch-1.0 -e v4l2src device="/dev/video4" ! queue ! videoconvert ! v4l2h264enc ! 'video/x-h264,level=(string)4' ! h264parse ! qtmux name=mux ! filesink location=test5.mp4 sync=false

単体GUIアプリケーション起動

vim /etc/xdg/lxsession/LXDE/autostart

#@lxpanel --profile LXDE
@pcmanfm --desktop --profile LXDE
#@xscreensaver -no-splash

vim /etc/xdg/lxsession/LXDE-pi/autostart

#@lxpanel --profile LXDE-pi
@pcmanfm --desktop --profile LXDE-pi
#@xscreensaver -no-splash

sudo tee -a /etc/systemd/system/my_app.service > /dev/null << EOT
[Unit]
Description=Start MY_APPLICATION
After=default.target
Wants=default.target

[Service]
Environment=USER_NAME=yasushi-sakita
User=${USER_NAME}
Group=${USER_NAME}
Environment=DISPLAY=:0.0
Environment=XAUTORITY=/home/${USER_NAME}/.Xauthority
ExecStart=/usr/bin/python3 /home/${USER_NAME}/dev/python/drive_recorder_display/main.py
Type=idle

[Install]
WantedBy=default.target
EOT


sudo /usr/bin/systemctl daemon-reload
sudo /usr/bin/systemctl enable my_app.service